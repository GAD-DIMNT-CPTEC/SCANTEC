
** Instrucoes para compilacao e execucao do scanTEC **

Para compilação e execução siga os seguintes passos:

Ultima atualizacao do README: 26/04/2017

*************************************************************************************************************************
Para instalação no supercomputador TUPA:
*************************************************************************************************************************

1º Logar no TUPA 

------
2º Logar no eslogin01:
> ssh eslogin01 -XC

------
3º Escolher um diretorio para a instalação do scanTEC
Obs. Pode ser nas areas $HOME/ ou $SUBMIT_HOME/ ou online6/ 
> cd $HOME

------
4º Obter o pacote do SCANTEC. Baixar a versao do repositorio svn (projetos.cptec.inpe.br)
> svn export  https://svn.cptec.inpe.br/scantec/tags/SCANTEC_V1.0
ou copiando do DVD
> cp /DVD/SCANTEC_V1.0 $HOME/

------
5º Entrar no diretorio do SCANTEC versao 1.0 
> cd SCANTEC_V1.0

------
6º Para compilar o SCANTEC execute o script install com o comando:
> ./install

Escolha a opção 3 para o compilador pgi do TUPA
> 3

Para avaliar se o processo de compilacao foi bem sucedido verifique o executavel se criado no diretorio bin. Para isso faca:
> ls bin/scantec.x

*************************************************************************************************************************
Para instalação em maquina local:
*************************************************************************************************************************

É necessario ter instalado:
-compilador ifort
-package SVN  (subversion) se tiver acesso ao repositório do CPTEC
-biblioteca LAPACK

------
1º Escolher um diretorio para a instalação do scanTEC
Obs. Pode ser nas areas $HOME/ ou outra qualquer 
> cd $HOME

------
2º Obter o pacote do SCANTEC. Baixar a versao do repositorio svn (projetos.cptec.inpe.br) se tiver acesso
> svn export https://svn.cptec.inpe.br/scantec/tags/SCANTEC_V1.0
ou copiando do DVD
> cp /DVD/SCANTEC_V1.0 $HOME/

------
3º Entrar no diretorio do SCANTEC versao 1.0 
> cd SCANTEC_V1.0

------
6º Para compilar o SCANTEC execute o script install com o comando:
> ./install

Escolha a opção 4 para o compilador ifort instalado em seu linux
> 4

Para avaliar se o processo de compilacao foi bem sucedido verifique o executavel se criado no diretorio bin. Para isso faca:
> ls bin/scantec.x

*************************************************************************************************************************
Para execucão do pacote usando um testeCase: usuarios iniciantes
*************************************************************************************************************************

------
1º Executar o scanTEC (Rodadas TestCase):
> ./run_scantec.sh [parametro]

Exemplos de utilização:
./run_scantec.sh 1 - para fazer um TestCase do G3DVAR (Ago/2014) 
./run_scantec.sh 2 - para fazer um TestCase do BRAMS (Jan/2016)
./run_scantec.sh 3 - para usar os dados definidos pelo usuario

* Na versao de distribuicao e disponibilizada externa ao CPTEC/INPE apenas os dados do AGCM foram disponibilizados, por questao de espaco em disco. Caso esteja no CPTEC inpe a versao para o BRAMS devera funcionar pois os dados estao em um local de acesso publico.

* Cabe ressaltar que nessa versão está sendo gerado apenas das métricas convencionais (RMS, VIES e CCA). Os resultados para as metricas de precipitacao nao esta disponivel nessa versao. Isso devera ser tratado e disponibilizado nas futuras versoes do sistema. 

Use Precipitation: 0
Use EOFs: 0

------
2º Executar o scanTEC usando os dados do AGCM (Rodadas TestCase):
> ./run_scantec.sh 1

------
3º Observe o processo de execucao do SCANTEC no run_scantec.sh ira preparar automaticamente um arquivo de configuracao do sistema e executara em seguida calculando as estatisticas do periodo solicitado. Ele fara os seguintes passos

(a) Criara o arquivo de configuracao é o core/scantec.conf com as seguintes configuracoes:

 =====================================     
 Configuracoes iniciais do Testcase:       
 =====================================     
 Data inicial:   2014080500                  
 Data final:     2014080612                  
 Passo analise:  12          
 Passo previsao: 24         
 Total previsao: 72 
 
 (b) Executará o scantec.x com os parametros lidos no core/scantec.conf. 
 Nesse processo sera informado a evolucao do processo dentro do periodo definido.
 
 (c) criara um arquivo de log da rodada do tipo:
 $HOME/SCANTEC_V1.0/exec_scantec_20170426.23.14.log
 
 (d) Colocara os arquivos de saida com tabelas e arquivos binarios no diretorio (definido no core/scantec.conf ):
 $HOME/SCANTEC_V1.0/saida_scantec_V1.0
 
 (e) Executará o GNUplot para gerar algumas figuras de apresentacao dos resultados. O arquivo chamado plot_scantec_results.eps
 criado no diretorio de saida sera criado. Ele pode ser acessado usando o comando evince. Faca
 > cd $HOME/SCANTEC_V1.0/saida_scantec_V1.0
 > evince plot_scantec_results.eps

*************************************************************************************************************************
Para execucão do pacote usando uma configuracao qualquer: usuarios avancados
**************************************************************************************************************************

------
1º Entrar no diretorio core/ onde estão os códigos do SCANTEC:
> cd $HOME/SCANTEC_V1.0/core/

------
2º Editar o arquivo de configuração de acordo com os experimentos:
> gedit scantec.conf&

É necessário:
-Configurar a data inicial e final, tempo de previsão e tempo de analise e total de previsao
-Configurar o recorte a ser escolhido (global, america sul ou brasil)
-Configurar o experimento referencia e numero de experimentos. 
-Configurar uso de climatologia (normalmente deixar o padrao como está)
-Define o diretorio da saida dos dados. Por exemplo: $HOME/SCANTEC_V1.0/saida_scantec_V1.0

Salve as configuracoes escolhidas.

------
3º Executar o SCANTEC (scantec.conf será usado o que foi pré-configurado no passo anterior)
> cd ../bin
> ./scantec.x

------
4º Acompanhe o processo e avalie os resultados no diretorio de saida escolhido
> cd $HOME/SCANTEC_V1.0/saida_scantec_V1.0
> ls *

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 Opção para executar o scanTEC submetendo no tupa:
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

------
1º Para executar o SCANTEC em um nó auxiliar com qsub é necessário ajustar o script: 
> gedit core/submete_scantec.qsub&

Ajustar:
-Tempo do walltime
-Diretorios dos logs e exec
Salvar as modificacoes nesse arquivo.

------
2º Para execução dar os comandos:
> module swap tupa2 aux
> qsub submete_scantec.qsub

------
3º Para acompanhar o processo:
> qstat -u ${USER} @aux20-eth4

------
4º Quando finalizado verificar os resultados no arquivo de saida configurado no arquivo core/scantec.conf 



